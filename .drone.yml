---
kind: pipeline
type: docker
name: Deploy to bbaovanc.com

trigger:
    branch:
        - master
    event:
        exclude:
            - pull_request

steps:
    - name: submodules
      image: alpine/git
      commands:
          - git submodule update --init --recursive

    - name: build
      image: bbaovanc/hugo
      commands:
          - hugo version
          - hugo --minify

    - name: list files
      image: alpine:latest
      commands:
          - find public/

    - name: upload
      image: appleboy/drone-scp
      settings:
          host: bbaovanc.com
          port: 2222
          username: droneci
          key:
              from_secret: SSH_KEY
          target: /var/www/bbaovanc/blog/
          rm: true
          source: public/
          strip_components: 1
